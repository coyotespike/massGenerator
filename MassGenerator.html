<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catholic Mass Guide Customizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            max-width: 8.5in;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.4;
            background: #f9f9f9;
        }

        .customizer {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .option-group {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 5px;
            border-left: 4px solid #8B4513;
        }

        .option-group h3 {
            margin-top: 0;
            color: #8B4513;
            font-size: 16px;
        }

        .option {
            margin: 10px 0;
        }

        .option label {
            display: block;
            padding: 8px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .option label:hover {
            background: #f0f0f0;
        }

        .option input[type="radio"] {
            margin-right: 8px;
        }

        .preview {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12pt;
            line-height: 1.6;
        }

        .preview h1 {
            text-align: center;
            color: #8B4513;
            font-size: 24pt;
            margin-bottom: 10px;
        }

        .preview h2 {
            color: #8B4513;
            font-size: 16pt;
            margin-top: 25px;
            margin-bottom: 10px;
            border-bottom: 1px solid #8B4513;
        }

        .preview h3 {
            color: #8B4513;
            font-size: 14pt;
            margin-top: 20px;
            margin-bottom: 8px;
        }

        .response {
            font-style: italic;
            color: #666;
            margin-left: 20px;
        }

        .instruction {
            font-style: italic;
            color: #999;
            font-size: 10pt;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: #8B4513;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #A0522D;
        }

        @media print {
            @page {
                size: landscape;
                margin: 0.5in;
            }

            body {
                background: white;
                max-width: none;
                margin: 0;
                padding: 0;
                font-size: 10pt;
                line-height: 1.3;
            }

            .customizer, .controls {
                display: none;
            }

            .preview {
                box-shadow: none;
                padding: 0;
                /* Remove fixed height and overflow hidden to allow content to flow across pages */
                height: auto;
                overflow: visible;
            }

            /* Special handling for first page - booklet cover */
            .preview::before {
                content: "";
                display: block;
                width: 50%;
                height: 100vh;
                float: left;
                page-break-after: avoid;
                break-after: avoid;
            }

            /* Cover page content */
            .preview h1:first-child {
                font-size: 24pt;
                margin: 0;
                padding: 0;
                width: 50%;
                float: right;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                page-break-after: always;
                break-after: page;
                column-span: none;
            }

            /* Rest of content in 2 columns */
            .preview h2:first-of-type {
                clear: both;
                column-span: all;
            }

            .preview {
                column-count: 2;
                column-gap: 0.5in;
                column-rule: 1px solid #ccc;
                column-fill: auto;
            }

            .preview h1 {
                font-size: 18pt;
                margin-bottom: 15px;
                text-align: center;
                page-break-after: avoid;
                break-after: avoid;
            }

            .preview h2 {
                font-size: 12pt;
                margin-top: 15px;
                margin-bottom: 8px;
                page-break-after: avoid;
                break-after: avoid;
                page-break-inside: avoid;
                break-inside: avoid;
            }

            .preview h3 {
                font-size: 11pt;
                margin-top: 12px;
                margin-bottom: 6px;
                page-break-after: avoid;
                break-after: avoid;
                page-break-inside: avoid;
                break-inside: avoid;
            }

            .preview h4 {
                font-size: 10pt;
                margin-top: 10px;
                margin-bottom: 4px;
                page-break-after: avoid;
                break-after: avoid;
                page-break-inside: avoid;
                break-inside: avoid;
            }

            .preview p {
                margin: 4px 0;
                page-break-inside: avoid;
                break-inside: avoid;
                orphans: 3;
                widows: 3;
            }

            .preview .instruction {
                font-size: 9pt;
            }

            .preview table {
                page-break-inside: avoid;
                break-inside: avoid;
                margin: 8px 0;
            }

            .preview table td {
                font-size: 9pt;
                padding: 4px 8px;
            }

            /* Ensure proper page breaks */
            .preview > * {
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="customizer">
        <h1>Customize Your Mass Guide</h1>
        <p>Select the versions your church uses, then click "Generate Guide" to create a printable version for your friend.</p>

        <div class="option-group">
            <h3>Greeting (after Sign of the Cross)</h3>
            <div class="option">
                <label>
                    <input type="radio" name="greeting" value="grace" checked>
                    "The grace of our Lord Jesus Christ, and the love of God, and the communion of the Holy Spirit be with you all."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="greeting" value="peace">
                    "Grace to you and peace from God our Father and the Lord Jesus Christ."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="greeting" value="lord">
                    "The Lord be with you."
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Penitential Act</h3>
            <div class="option">
                <label>
                    <input type="radio" name="penitential" value="confiteor" checked>
                    "I confess to almighty God..." (Confiteor)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="penitential" value="mercy">
                    "Have mercy on us, O Lord..."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="penitential" value="invocations">
                    "You were sent to heal the contrite of heart..." (Invocations)
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Kyrie</h3>
            <div class="option">
                <label>
                    <input type="radio" name="kyrie" value="english" checked>
                    "Lord, have mercy" (English)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="kyrie" value="latin">
                    "Kyrie, eleison" (Latin)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="kyrie" value="skip">
                    Skip Kyrie (not used at your church)
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Gloria</h3>
            <div class="option">
                <label>
                    <input type="radio" name="gloria" value="include" checked>
                    Include Gloria
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="gloria" value="skip">
                    Skip Gloria (note when it's used)
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Creed</h3>
            <div class="option">
                <label>
                    <input type="radio" name="creed" value="nicene" checked>
                    Niceno-Constantinopolitan Creed (longer)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="creed" value="apostles">
                    Apostles' Creed (shorter)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="creed" value="both">
                    Include both (show which is used when)
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Mystery of Faith (after Consecration)</h3>
            <div class="option">
                <label>
                    <input type="radio" name="mystery" value="proclaim" checked>
                    "We proclaim your Death, O Lord..."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="mystery" value="eat">
                    "When we eat this Bread and drink this Cup..."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="mystery" value="save">
                    "Save us, Saviour of the world..."
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Prayer of the Faithful Response</h3>
            <div class="option">
                <label>
                    <input type="radio" name="faithful" value="mercy" checked>
                    "Lord, in your mercy. Hear our prayer."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="faithful" value="short">
                    "Lord, hear our prayer."
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Holy, Holy, Holy (Sanctus)</h3>
            <div class="option">
                <label>
                    <input type="radio" name="sanctus" value="english" checked>
                    English version
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="sanctus" value="latin">
                    Latin version (Sanctus)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="sanctus" value="both">
                    Include both versions
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Lamb of God (Agnus Dei)</h3>
            <div class="option">
                <label>
                    <input type="radio" name="agnus" value="english" checked>
                    English version
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="agnus" value="latin">
                    Latin version (Agnus Dei)
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="agnus" value="both">
                    Include both versions
                </label>
            </div>
        </div>

        <div class="option-group">
            <h3>Dismissal</h3>
            <div class="option">
                <label>
                    <input type="radio" name="dismissal" value="ended" checked>
                    "Go forth, the Mass is ended."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="dismissal" value="announce">
                    "Go and announce the Gospel of the Lord."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="dismissal" value="glorify">
                    "Go in peace, glorifying the Lord by your life."
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="radio" name="dismissal" value="peace">
                    "Go in peace."
                </label>
            </div>
        </div>

        <div class="controls">
            <button onclick="generateGuide()">Generate Guide</button>
            <button onclick="printBooklet()">Print Booklet</button>
            <button onclick="downloadPDF()">Download PDF</button>
        </div>
    </div>

    <div class="preview" id="guide">
        <p style="text-align: center; color: #666;">Select your options above and click "Generate Guide" to create your customized Mass guide.</p>
    </div>

    <script>
        function generateGuide() {
            const greeting = document.querySelector('input[name="greeting"]:checked').value;
            const penitential = document.querySelector('input[name="penitential"]:checked').value;
            const kyrie = document.querySelector('input[name="kyrie"]:checked').value;
            const gloria = document.querySelector('input[name="gloria"]:checked').value;
            const creed = document.querySelector('input[name="creed"]:checked').value;
            const faithful = document.querySelector('input[name="faithful"]:checked').value;
            const sanctus = document.querySelector('input[name="sanctus"]:checked').value;
            const mystery = document.querySelector('input[name="mystery"]:checked').value;
            const agnus = document.querySelector('input[name="agnus"]:checked').value;
            const dismissal = document.querySelector('input[name="dismissal"]:checked').value;

            let html = `
                <h1>Guide to the Catholic Mass</h1>

                <h2>The Introductory Rites</h2>
                <p class="instruction">All stand. The priest enters and venerates the altar.</p>

                <h3>Sign of the Cross</h3>
                <p><strong>Priest:</strong> In the name of the Father, and of the Son, and of the Holy Spirit.</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h3>Greeting</h3>`;

            // Add selected greeting
            if (greeting === 'grace') {
                html += `
                    <p><strong>Priest:</strong> The grace of our Lord Jesus Christ, and the love of God, and the communion of the Holy Spirit be with you all.</p>`;
            } else if (greeting === 'peace') {
                html += `
                    <p><strong>Priest:</strong> Grace to you and peace from God our Father and the Lord Jesus Christ.</p>`;
            } else if (greeting === 'lord') {
                html += `
                    <p><strong>Priest:</strong> The Lord be with you.</p>`;
            }
            html += `<p class="response"><strong>All:</strong> And with your spirit.</p>`;

            // Add selected penitential act
            html += `<h3>Penitential Act</h3>`;
            if (penitential === 'confiteor') {
                html += `
                    <p><strong>All:</strong> I confess to almighty God<br>
                    and to you, my brothers and sisters,<br>
                    that I have greatly sinned,<br>
                    in my thoughts and in my words,<br>
                    in what I have done and in what I have failed to do,</p>
                    <p class="instruction">(Strike breast)</p>
                    <p><strong>All:</strong> through my fault, through my fault,<br>
                    through my most grievous fault;<br>
                    therefore I ask blessed Mary ever-Virgin,<br>
                    all the Angels and Saints,<br>
                    and you, my brothers and sisters,<br>
                    to pray for me to the Lord our God.</p>`;
            } else if (penitential === 'mercy') {
                html += `
                    <p><strong>Priest:</strong> Have mercy on us, O Lord.</p>
                    <p class="response"><strong>All:</strong> For we have sinned against you.</p>
                    <p><strong>Priest:</strong> Show us, O Lord, your mercy.</p>
                    <p class="response"><strong>All:</strong> And grant us your salvation.</p>`;
            } else if (penitential === 'invocations') {
                html += `
                    <p><strong>Priest:</strong> You were sent to heal the contrite of heart:</p>
                    <p class="response"><strong>All:</strong> Lord, have mercy.</p>
                    <p><strong>Priest:</strong> You came to call sinners:</p>
                    <p class="response"><strong>All:</strong> Christ, have mercy.</p>
                    <p><strong>Priest:</strong> You are seated at the right hand of the Father to intercede for us:</p>
                    <p class="response"><strong>All:</strong> Lord, have mercy.</p>`;
            }

            html += `
                <p><strong>Priest:</strong> May almighty God have mercy on us, forgive us our sins, and bring us to everlasting life.</p>
                <p class="response"><strong>All:</strong> Amen.</p>`;

            // Add Kyrie if selected
            if (kyrie !== 'skip') {
                html += `<h3>Kyrie</h3>`;
                const kyrieText = kyrie === 'latin' ? 'Kyrie, eleison' : 'Lord, have mercy';
                const christeText = kyrie === 'latin' ? 'Christe, eleison' : 'Christ, have mercy';

                html += `
                    <p class="response"><strong>All:</strong> ${kyrieText}. ${kyrieText}.</p>
                    <p class="response"><strong>All:</strong> ${christeText}. ${christeText}.</p>
                    <p class="response"><strong>All:</strong> ${kyrieText}. ${kyrieText}.</p>`;
            }

            // Add Gloria if selected
            if (gloria === 'include') {
                html += `
                    <h3>Gloria</h3>
                    <p class="instruction">(When indicated, usually on Sundays and feast days)</p>
                    <p><strong>All:</strong> Glory to God in the highest,<br>
                    and on earth peace to people of good will.<br>
                    We praise you, we bless you, we adore you, we glorify you,<br>
                    we give you thanks for your great glory,<br>
                    Lord God, heavenly King, O God, almighty Father.<br>
                    Lord Jesus Christ, Only Begotten Son,<br>
                    Lord God, Lamb of God, Son of the Father,<br>
                    you take away the sins of the world, have mercy on us;<br>
                    you take away the sins of the world, receive our prayer;<br>
                    you are seated at the right hand of the Father, have mercy on us.<br>
                    For you alone are the Holy One, you alone are the Lord,<br>
                    you alone are the Most High, Jesus Christ,<br>
                    with the Holy Spirit, in the glory of God the Father. Amen.</p>`;
            } else {
                html += `<p class="instruction"><em>Gloria is sung on Sundays and feast days (not during Advent or Lent)</em></p>`;
            }

            html += `
                <h3>Collect (Opening Prayer)</h3>
                <p><strong>Priest:</strong> Let us pray.</p>
                <p class="instruction">(Pause for silent prayer)</p>
                <p class="instruction">(Priest says the Collect prayer)</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h2>The Liturgy of the Word</h2>
                <p class="instruction">All sit for the readings</p>

                <h3>First Reading</h3>
                <p class="instruction">(Reader concludes:)</p>
                <p><strong>Reader:</strong> The word of the Lord.</p>
                <p class="response"><strong>All:</strong> Thanks be to God.</p>

                <h3>Responsorial Psalm</h3>
                <p class="instruction">(Cantor sings verses, all respond with the refrain)</p>

                <h3>Second Reading</h3>
                <p class="instruction">(On Sundays and major feasts)</p>
                <p><strong>Reader:</strong> The word of the Lord.</p>
                <p class="response"><strong>All:</strong> Thanks be to God.</p>

                <h3>Gospel</h3>
                <p class="instruction">All stand</p>
                <p class="instruction">(Gospel Acclamation - usually "Alleluia")</p>
                <p><strong>Priest/Deacon:</strong> The Lord be with you.</p>
                <p class="response"><strong>All:</strong> And with your spirit.</p>
                <p><strong>Priest/Deacon:</strong> A reading from the holy Gospel according to N.</p>
                <p class="response"><strong>All:</strong> Glory to you, O Lord.</p>
                <p class="instruction">(Gospel is proclaimed)</p>
                <p><strong>Priest/Deacon:</strong> The Gospel of the Lord.</p>
                <p class="response"><strong>All:</strong> Praise to you, Lord Jesus Christ.</p>

                <h3>Homily</h3>
                <p class="instruction">All sit. Brief silence for reflection may follow.</p>

                <h3>Creed</h3>
                <p class="instruction">All stand (on Sundays and major feasts)</p>`;

            // Add selected creed
            if (creed === 'nicene' || creed === 'both') {
                html += `
                    <h4>Niceno-Constantinopolitan Creed</h4>
                    <p class="instruction">(Usually used)</p>
                    <p><strong>All:</strong> I believe in one God, the Father almighty,<br>
                    maker of heaven and earth, of all things visible and invisible.<br>
                    I believe in one Lord Jesus Christ, the Only Begotten Son of God,<br>
                    born of the Father before all ages.<br>
                    God from God, Light from Light, true God from true God,<br>
                    begotten, not made, consubstantial with the Father;<br>
                    through him all things were made.<br>
                    For us men and for our salvation he came down from heaven,</p>
                    <p class="instruction">(All bow)</p>
                    <p><strong>All:</strong> and by the Holy Spirit was incarnate of the Virgin Mary, and became man.</p>
                    <p class="instruction">(Stand upright)</p>
                    <p><strong>All:</strong> For our sake he was crucified under Pontius Pilate,<br>
                    he suffered death and was buried,<br>
                    and rose again on the third day in accordance with the Scriptures.<br>
                    He ascended into heaven and is seated at the right hand of the Father.<br>
                    He will come again in glory to judge the living and the dead<br>
                    and his kingdom will have no end.<br>
                    I believe in the Holy Spirit, the Lord, the giver of life,<br>
                    who proceeds from the Father and the Son,<br>
                    who with the Father and the Son is adored and glorified,<br>
                    who has spoken through the prophets.<br>
                    I believe in one, holy, catholic and apostolic Church.<br>
                    I confess one Baptism for the forgiveness of sins<br>
                    and I look forward to the resurrection of the dead<br>
                    and the life of the world to come. Amen.</p>`;
            }

            if (creed === 'apostles' || creed === 'both') {
                if (creed === 'both') html += `<h4>Apostles' Creed</h4><p class="instruction">(Sometimes used during Lent and Easter)</p>`;
                html += `
                    <p><strong>All:</strong> I believe in God, the Father almighty,<br>
                    Creator of heaven and earth,<br>
                    and in Jesus Christ, his only Son, our Lord,</p>
                    <p class="instruction">(All bow)</p>
                    <p><strong>All:</strong> who was conceived by the Holy Spirit, born of the Virgin Mary,</p>
                    <p class="instruction">(Stand upright)</p>
                    <p><strong>All:</strong> suffered under Pontius Pilate,<br>
                    was crucified, died and was buried;<br>
                    he descended into hell;<br>
                    on the third day he rose again from the dead;<br>
                    he ascended into heaven,<br>
                    and is seated at the right hand of God the Father almighty;<br>
                    from there he will come to judge the living and the dead.<br>
                    I believe in the Holy Spirit, the holy catholic Church,<br>
                    the communion of saints, the forgiveness of sins,<br>
                    the resurrection of the body, and life everlasting. Amen.</p>`;
            }

            html += `
                <h3>Prayer of the Faithful</h3>
                <p class="instruction">(Intercessions are offered)</p>`;

            // Add selected faithful response
            if (faithful === 'mercy') {
                html += `<p class="response"><strong>All:</strong> Lord, in your mercy. <em>Hear our prayer.</em></p>`;
            } else {
                html += `<p class="response"><strong>All:</strong> Lord, hear our prayer.</p>`;
            }

            html += `<p class="instruction">All sit after the concluding prayer</p>

                <h2>The Liturgy of the Eucharist</h2>

                <h3>Presentation of the Gifts</h3>
                <p class="instruction">(Offertory song as gifts are brought forward)</p>
                <p class="instruction">(Priest prepares the gifts. If prayers are said aloud:)</p>
                <p class="response"><strong>All:</strong> Blessed be God for ever.</p>

                <h3>Prayer over the Offerings</h3>
                <p class="instruction">All stand</p>
                <p><strong>Priest:</strong> Pray, brethren, that my sacrifice and yours<br>
                may be acceptable to God, the almighty Father.</p>
                <p class="response"><strong>All:</strong> May the Lord accept the sacrifice at your hands<br>
                for the praise and glory of his name,<br>
                for our good and the good of all his holy Church.</p>
                <p class="instruction">(Prayer over the Offerings)</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h3>Eucharistic Prayer</h3>
                <p><strong>Priest:</strong> The Lord be with you.</p>
                <p class="response"><strong>All:</strong> And with your spirit.</p>
                <p><strong>Priest:</strong> Lift up your hearts.</p>
                <p class="response"><strong>All:</strong> We lift them up to the Lord.</p>
                <p><strong>Priest:</strong> Let us give thanks to the Lord our God.</p>
                <p class="response"><strong>All:</strong> It is right and just.</p>

                <p class="instruction">(Preface concludes with:)</p>`;

            // Add selected Sanctus
            if (sanctus === 'english') {
                html += `
                    <h3>Holy, Holy, Holy</h3>
                    <p><strong>All:</strong> Holy, Holy, Holy Lord God of hosts.<br>
                    Heaven and earth are full of your glory.<br>
                    Hosanna in the highest.<br>
                    Blessed is he who comes in the name of the Lord.<br>
                    Hosanna in the highest.</p>`;
            } else if (sanctus === 'latin') {
                html += `
                    <h3>Sanctus</h3>
                    <p><strong>All:</strong> Sanctus, Sanctus, Sanctus Dominus Deus Sabaoth.<br>
                    Pleni sunt caeli et terra gloria tua.<br>
                    Hosanna in excelsis.<br>
                    Benedictus qui venit in nomine Domini.<br>
                    Hosanna in excelsis.</p>`;
            } else { // both
                html += `
                    <h3>Holy, Holy, Holy / Sanctus</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 50%; padding-right: 15px; vertical-align: top;">
                                <p><strong>English:</strong><br>
                                Holy, Holy, Holy Lord God of hosts.<br>
                                Heaven and earth are full of your glory.<br>
                                Hosanna in the highest.<br>
                                Blessed is he who comes in the name of the Lord.<br>
                                Hosanna in the highest.</p>
                            </td>
                            <td style="width: 50%; padding-left: 15px; vertical-align: top; border-left: 1px solid #ddd;">
                                <p><strong>Latin:</strong><br>
                                Sanctus, Sanctus, Sanctus Dominus Deus Sabaoth.<br>
                                Pleni sunt caeli et terra gloria tua.<br>
                                Hosanna in excelsis.<br>
                                Benedictus qui venit in nomine Domini.<br>
                                Hosanna in excelsis.</p>
                            </td>
                        </tr>
                    </table>`;
            }

            html += `

                <p class="instruction">(Eucharistic Prayer continues... After the words of Consecration:)</p>
                <p><strong>Priest:</strong> The mystery of faith.</p>`;

            // Add selected mystery of faith
            if (mystery === 'proclaim') {
                html += `<p class="response"><strong>All:</strong> We proclaim your Death, O Lord,<br>and profess your Resurrection until you come again.</p>`;
            } else if (mystery === 'eat') {
                html += `<p class="response"><strong>All:</strong> When we eat this Bread and drink this Cup,<br>we proclaim your Death, O Lord, until you come again.</p>`;
            } else if (mystery === 'save') {
                html += `<p class="response"><strong>All:</strong> Save us, Saviour of the world,<br>for by your Cross and Resurrection you have set us free.</p>`;
            }

            html += `
                <p class="instruction">(Prayer concludes with the Great Doxology:)</p>
                <p><strong>Priest:</strong> Through him, and with him, and in him,<br>
                O God, almighty Father, in the unity of the Holy Spirit,<br>
                all glory and honour is yours, for ever and ever.</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h2>The Communion Rite</h2>

                <h3>The Lord's Prayer</h3>
                <p><strong>Priest:</strong> At the Saviour's command and formed by divine teaching, we dare to say:</p>
                <p><strong>All:</strong> Our Father, who art in heaven, hallowed be thy name;<br>
                thy kingdom come, thy will be done on earth as it is in heaven.<br>
                Give us this day our daily bread,<br>
                and forgive us our trespasses, as we forgive those who trespass against us;<br>
                and lead us not into temptation, but deliver us from evil.</p>

                <p><strong>Priest:</strong> Deliver us, Lord, we pray... and the coming of our Saviour, Jesus Christ.</p>
                <p class="response"><strong>All:</strong> For the kingdom, the power and the glory are yours now and for ever.</p>

                <h3>Sign of Peace</h3>
                <p><strong>Priest:</strong> Lord Jesus Christ... Who live and reign for ever and ever.</p>
                <p class="response"><strong>All:</strong> Amen.</p>
                <p><strong>Priest:</strong> The peace of the Lord be with you always.</p>
                <p class="response"><strong>All:</strong> And with your spirit.</p>
                <p><strong>Priest:</strong> Let us offer each other the sign of peace.</p>
                <p class="instruction">(Exchange sign of peace)</p>

                <h3>Breaking of the Bread</h3>`;

            // Add selected Agnus Dei
            if (agnus === 'english') {
                html += `
                    <h3>Lamb of God</h3>
                    <p><strong>All:</strong> Lamb of God, you take away the sins of the world, have mercy on us.<br>
                    Lamb of God, you take away the sins of the world, have mercy on us.<br>
                    Lamb of God, you take away the sins of the world, grant us peace.</p>`;
            } else if (agnus === 'latin') {
                html += `
                    <h3>Agnus Dei</h3>
                    <p><strong>All:</strong> Agnus Dei, qui tollis peccata mundi, miserere nobis.<br>
                    Agnus Dei, qui tollis peccata mundi, miserere nobis.<br>
                    Agnus Dei, qui tollis peccata mundi, dona nobis pacem.</p>`;
            } else { // both
                html += `
                    <h3>Lamb of God / Agnus Dei</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="width: 50%; padding-right: 15px; vertical-align: top;">
                                <p><strong>English:</strong><br>
                                Lamb of God, you take away the sins of the world, have mercy on us.<br>
                                Lamb of God, you take away the sins of the world, have mercy on us.<br>
                                Lamb of God, you take away the sins of the world, grant us peace.</p>
                            </td>
                            <td style="width: 50%; padding-left: 15px; vertical-align: top; border-left: 1px solid #ddd;">
                                <p><strong>Latin:</strong><br>
                                Agnus Dei, qui tollis peccata mundi, miserere nobis.<br>
                                Agnus Dei, qui tollis peccata mundi, miserere nobis.<br>
                                Agnus Dei, qui tollis peccata mundi, dona nobis pacem.</p>
                            </td>
                        </tr>
                    </table>`;
            }

            html += `

                <h3>Invitation to Communion</h3>
                <p class="instruction">All kneel</p>
                <p><strong>Priest:</strong> Behold the Lamb of God,<br>
                behold him who takes away the sins of the world.<br>
                Blessed are those called to the supper of the Lamb.</p>
                <p class="response"><strong>All:</strong> Lord, I am not worthy that you should enter under my roof,<br>
                but only say the word and my soul shall be healed.</p>

                <h3>Communion</h3>
                <p class="instruction">(Bow head before receiving)</p>
                <p><strong>Minister:</strong> The Body of Christ. <em>(or: The Blood of Christ)</em></p>
                <p class="response"><strong>Communicant:</strong> Amen.</p>

                <h3>Prayer after Communion</h3>
                <p class="instruction">All stand after silent prayer/communion song</p>
                <p><strong>Priest:</strong> Let us pray.</p>
                <p class="instruction">(Silent prayer, then Prayer after Communion)</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h2>The Concluding Rites</h2>

                <h3>Blessing</h3>
                <p><strong>Priest:</strong> The Lord be with you.</p>
                <p class="response"><strong>All:</strong> And with your spirit.</p>
                <p><strong>Priest:</strong> May almighty God bless you,<br>
                the Father, and the Son, and the Holy Spirit.</p>
                <p class="response"><strong>All:</strong> Amen.</p>

                <h3>Dismissal</h3>`;

            // Add selected dismissal
            if (dismissal === 'ended') {
                html += `<p><strong>Priest/Deacon:</strong> Go forth, the Mass is ended.</p>`;
            } else if (dismissal === 'announce') {
                html += `<p><strong>Priest/Deacon:</strong> Go and announce the Gospel of the Lord.</p>`;
            } else if (dismissal === 'glorify') {
                html += `<p><strong>Priest/Deacon:</strong> Go in peace, glorifying the Lord by your life.</p>`;
            } else if (dismissal === 'peace') {
                html += `<p><strong>Priest/Deacon:</strong> Go in peace.</p>`;
            }

            html += `
                <p class="response"><strong>All:</strong> Thanks be to God.</p>

                <hr style="margin-top: 40px; border: 1px solid #8B4513;">
                <p style="text-align: center; font-size: 10pt; color: #666; margin-top: 20px;">
                <em>This guide is based on the English translation of The Roman Missal © 2010, International Commission on English in the Liturgy Corporation.</em>
                </p>`;

            document.getElementById('guide').innerHTML = html;
        }

        function printBooklet() {
            generateGuide(); // Make sure preview is up to date
            window.print();
        }

        function downloadPDF() {
            generateGuide(); // Ensure fresh content

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'letter'
            });

            // Get the guide content
            const guide = document.getElementById('guide');

            // Parse the HTML content
            const parseElement = (element) => {
                const content = [];

                const processNode = (node, parentStyle = {}) => {
                    if (node.nodeType === 3) { // Text node
                        const text = node.textContent.trim();
                        if (text) {
                            content.push({
                                type: 'text',
                                text: text,
                                style: parentStyle
                            });
                        }
                    } else if (node.nodeType === 1) { // Element node
                        let style = { ...parentStyle };
                        let addBreak = false;

                        // Determine style based on tag
                        switch (node.tagName) {
                            case 'H1':
                                style = { fontSize: 20, bold: true, align: 'center' };
                                addBreak = true;
                                break;
                            case 'H2':
                                style = { fontSize: 16, bold: true };
                                addBreak = true;
                                break;
                            case 'H3':
                                style = { fontSize: 14, bold: true };
                                addBreak = true;
                                break;
                            case 'H4':
                                style = { fontSize: 12, bold: true };
                                addBreak = true;
                                break;
                            case 'STRONG':
                                style.bold = true;
                                break;
                            case 'EM':
                            case 'I':
                                style.italic = true;
                                break;
                            case 'P':
                                addBreak = true;
                                break;
                            case 'BR':
                                content.push({ type: 'break' });
                                return;
                        }

                        // Check for specific classes
                        if (node.classList.contains('response')) {
                            style.italic = true;
                            style.indent = 20;
                        }
                        if (node.classList.contains('instruction')) {
                            style.italic = true;
                            style.fontSize = 9;
                        }

                        if (addBreak && content.length > 0) {
                            content.push({ type: 'break' });
                        }

                        // Process children
                        for (let child of node.childNodes) {
                            processNode(child, style);
                        }

                        if (addBreak) {
                            content.push({ type: 'break' });
                        }
                    }
                };

                processNode(element);
                return content;
            };

            const content = parseElement(guide);

            // PDF rendering settings
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margins = { top: 40, bottom: 40, left: 40, right: 40 };
            const lineHeight = 14;
            let x = margins.left;
            let y = margins.top;

            // Render content
            content.forEach((item, index) => {
                if (item.type === 'break') {
                    y += lineHeight * 0.5;
                    return;
                }

                if (item.type === 'text') {
                    // Check if we need a new page
                    if (y > pageHeight - margins.bottom) {
                        doc.addPage();
                        y = margins.top;
                    }

                    // Set font style
                    const fontStyle = item.style.bold ? (item.style.italic ? 'bolditalic' : 'bold') :
                                    (item.style.italic ? 'italic' : 'normal');
                    doc.setFont('times', fontStyle);
                    doc.setFontSize(item.style.fontSize || 11);

                    // Calculate x position
                    let textX = margins.left + (item.style.indent || 0);

                    if (item.style.align === 'center') {
                        const textWidth = doc.getTextWidth(item.text);
                        textX = (pageWidth - textWidth) / 2;
                    }

                    // Word wrap
                    const maxWidth = pageWidth - margins.left - margins.right - (item.style.indent || 0);
                    const lines = doc.splitTextToSize(item.text, maxWidth);

                    lines.forEach(line => {
                        if (y > pageHeight - margins.bottom) {
                            doc.addPage();
                            y = margins.top;
                        }
                        doc.text(line, textX, y);
                        y += lineHeight;
                    });
                }
            });

            // Save the PDF
            doc.save('Catholic_Mass_Guide.pdf');
        }

        // Generate guide on load with default options
        window.addEventListener('load', generateGuide);
    </script>
</body>
</html>
